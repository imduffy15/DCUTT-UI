"use strict";angular.module("dcuttUiApp",["ionic","LocalStorageModule","angular-promise-cache"]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","localStorageServiceProvider",function(a,b,c,d){a.state("main",{url:"/",templateUrl:"views/courseSelector.html",controller:"CourseSelectorCtrl",resolve:{check:["$location","localStorageService",function(a,b){b.get("COURSECODE")&&a.path("/timetable/"+b.get("COURSECODE"))}]}}).state("timetable",{url:"/timetable/:coursecode",templateUrl:"views/timetable.html",controller:"TimetableCtrl"}),b.otherwise("/"),c.backButton.text("").previousTitleText(!1).icon("ion-arrow-left-c"),c.navBar.alignTitle("center"),d.setPrefix("DCUTT")}]).run(["$ionicPlatform",function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("dcuttUiApp").constant("ENV",{name:"production",apiEndpoint:"http://api.dcutt.com/v2"}),angular.module("dcuttUiApp").controller("CourseSelectorCtrl",["$scope","$location","courseCode","localStorageService",function(a,b,c,d){c.get().then(function(b){a.courseCodes=b.data}),a.selectCourse=function(a){d.set("COURSECODE",a),b.path("timetable/"+a)}}]),angular.module("dcuttUiApp").controller("TimetableCtrl",["$scope","$stateParams","$location","localStorageService","timetable",function(a,b,c,d,e){var f=function(b){37===b.keyCode&&(a.onSwipeRight(),a.$apply()),39===b.keyCode&&(a.onSwipeLeft(),a.$apply())},g=angular.element(document);g.on("keydown",f),a.$on("$destroy",function(){g.off("keydown",f)});var h={};a.coursecode=b.coursecode.toUpperCase(),e.get(b.coursecode).then(function(a){h=a.data,i(moment())},function(){a.courseCodes(),alert("Error retriving timetable")}),a.onSwipeLeft=function(){i(moment(a.date,"YYYY-MM-DD").add("d",1))},a.onSwipeRight=function(){i(moment(a.date,"YYYY-MM-DD").subtract("d",1))};var i=function(b){a.date=b.format("YYYY-MM-DD"),a.dayName=b.format("dddd"),a.timetable=h[b.valueOf()]};a.dateToTime=function(a){return a=moment(a),a.format("hh:mm a")},a.courseCodes=function(){d.remove("COURSECODE"),c.path("/")}}]),angular.module("dcuttUiApp").factory("courseCode",["$http","promiseCache","ENV",function(a,b,c){return{get:function(){return b({promise:function(){return a.get(c.apiEndpoint+"/coursecode")},ttl:2592e5,localStorageEnabled:!0,localStorageKey:"DCUTT.COURSECODES",expireOnFailure:function(a){return 200!==a.status}})}}}]),angular.module("dcuttUiApp").factory("timetable",["$http","promiseCache","ENV",function(a,b,c){return{get:function(d){return b({promise:function(){return a.get(c.apiEndpoint+"/timetable/"+d)},ttl:2592e5,localStorageEnabled:!0,localStorageKey:"DCUTT."+d.toUpperCase(),key:d,expireOnFailure:function(a){return 200!==a.status}})}}}]);